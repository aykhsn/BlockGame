<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.55.2/phaser.min.js"></script>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #ffffff;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <script>
        const config = {
            type: Phaser.AUTO,
            width: window.innerWidth,
            height: window.innerHeight,
            backgroundColor: '#ffffff',
            scale: {
                mode: Phaser.Scale.FIT,
                autoCenter: Phaser.Scale.CENTER_BOTH
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        const game = new Phaser.Game(config);

        function preload() {
            // 画像をロード
            this.load.image('box', 'assets/box.png');
            this.load.image('lid', 'assets/lid.png');
        }

        function create() {
            // 画面のサイズに基づいて箱のサイズを計算
            const boxHeight =  Math.min(this.scale.height, this.scale.width) / 3;
            const boxWidth = boxHeight * (this.textures.get('box').getSourceImage().width / this.textures.get('box').getSourceImage().height);

            // 画面の下に箱を配置
            const box = this.add.sprite(this.scale.width / 2, this.scale.height - boxHeight / 2 - 40, 'box');
            box.setDisplaySize(boxWidth, boxHeight);

            // 蓋を箱の上に配置
            const lid = this.add.sprite(this.scale.width / 2 + boxWidth * 0.88 / 2, this.scale.height - boxHeight - 40, 'lid');
            lid.setDisplaySize(boxWidth * 1.1, boxHeight * 3 / 10);
            lid.setOrigin(0.9, 0.5); // 右下を基点に設定

            let isLidOpen = false; // 蓋の状態を追跡

            // 箱をタップしたときのアニメーションを設定
            box.setInteractive();
            box.on('pointerdown', () => {
                this.tweens.add({
                    targets: lid,
                    angle: isLidOpen ? 0 : 180, // 状態に応じて蓋を開閉
                    duration: 1000,
                    ease: 'Power2'
                });
                isLidOpen = !isLidOpen; // 蓋の状態を更新
            });
        }

        function update() {
        }

        window.addEventListener('resize', () => {
            game.scale.resize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
